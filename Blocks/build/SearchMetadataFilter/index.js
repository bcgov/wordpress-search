(()=>{"use strict";var e,t={299:(e,t,s)=>{const a=window.wp.blocks,r=window.wp.data,n=window.wp.element,o=window.wp.coreData,l=window.wp.components,i=window.wp.i18n,d=window.wp.blockEditor,c=window.wp.url,p=window.wp.apiFetch;var _=s.n(p);const w=window.ReactJSXRuntime,u=["attachment","wp_block","wp_template","wp_template_part","wp_navigation","wp_font_face","wp_font_family","menu_item","wp_global_styles","revision","customize_changeset","nav_menu_item","custom_css","oembed_cache"],h=["document_file_id","document_file_name","document_file_size","document_file_type","document_file_url","footnotes","show_inpage_nav"];(0,a.registerBlockType)("wordpress-search/search-metadata-filter",{edit:function({attributes:e,setAttributes:t}){const{selectedMetadata:s}=e,[a,p]=(0,n.useState)([]),[m,f]=(0,n.useState)(!0),{postTypes:v}=(0,r.useSelect)((e=>{const t=e(o.store).getPostTypes({per_page:-1}),s=t?.filter((e=>{const t=u.includes(e.slug),s=Boolean(e.rest_base)&&Boolean(e.rest_namespace),a=!0===e.supports?.["custom-fields"];return!t&&s&&a}));return{postTypes:s}}),[]);return(0,n.useEffect)((()=>{!async function(){if(!v)return;const e=new Set,t=v.map((async e=>{try{const t="wp/v2"===e.rest_namespace?`/wp/v2/${e.rest_base}`:`/${e.rest_namespace}/${e.rest_base}`,s={context:"edit",per_page:1,orderby:"date",order:"desc"},a=(0,c.addQueryArgs)(t,s),r=await _()({path:a,parse:!0});if(Array.isArray(r)&&r.length>0){const t=r[0];return Object.keys(t.metadata||t.meta||{}).filter((e=>!h.includes(e))).map((t=>({label:t,value:`${e.slug}:${t}`})))}return[]}catch(e){return[]}}));try{(await Promise.all(t)).flat().forEach((t=>{e.add(t)}))}catch(e){}const s=Array.from(e).sort(((e,t)=>e.label.localeCompare(t.label)));p(s),f(!1)}()}),[v]),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(d.InspectorControls,{children:(0,w.jsxs)(l.PanelBody,{title:(0,i.__)("Metadata Filter Settings","wordpress-search"),initialOpen:!0,children:[m&&(0,w.jsxs)(l.Placeholder,{children:[(0,w.jsx)(l.Spinner,{}),(0,i.__)("Loading metadata fields…","wordpress-search")]}),!m&&a.length>0&&(0,w.jsx)(l.SelectControl,{label:(0,i.__)("Select Metadata Field","wordpress-search"),value:s,options:[{label:(0,i.__)("Select a field…","wordpress-search"),value:""},...a],onChange:e=>t({selectedMetadata:e})}),!m&&0===a.length&&(0,w.jsxs)("p",{children:[(0,i.__)("No metadata fields found. Make sure your post types:","wordpress-search"),(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:(0,i.__)("Have custom fields enabled","wordpress-search")}),(0,w.jsx)("li",{children:(0,i.__)("Have REST API support","wordpress-search")}),(0,w.jsx)("li",{children:(0,i.__)("Have at least one post with meta values","wordpress-search")}),(0,w.jsx)("li",{children:(0,i.__)("Have meta fields registered with show_in_rest enabled","wordpress-search")})]})]})]})}),(0,w.jsxs)("div",{className:"wp-block-wordpress-search-metadata-filter",children:[m&&(0,w.jsxs)("div",{className:"metadata-filter-loading",children:[(0,w.jsx)(l.Spinner,{}),(0,i.__)("Loading metadata options…","wordpress-search")]}),!m&&s&&(0,w.jsxs)("div",{className:"metadata-filter-preview",children:[(0,i.__)("Metadata Filter:","wordpress-search")," ",(0,w.jsx)("strong",{children:(()=>{if(!s)return"";const e=a.find((e=>e.value===s));return e?e.label:s})()})]}),!m&&!s&&(0,w.jsx)("div",{className:"metadata-filter-placeholder",children:(0,i.__)("Select a metadata field in the block settings sidebar →","wordpress-search")})]})]})},save:()=>null})}},s={};function a(e){var r=s[e];if(void 0!==r)return r.exports;var n=s[e]={exports:{}};return t[e](n,n.exports,a),n.exports}a.m=t,e=[],a.O=(t,s,r,n)=>{if(!s){var o=1/0;for(c=0;c<e.length;c++){for(var[s,r,n]=e[c],l=!0,i=0;i<s.length;i++)(!1&n||o>=n)&&Object.keys(a.O).every((e=>a.O[e](s[i])))?s.splice(i--,1):(l=!1,n<o&&(o=n));if(l){e.splice(c--,1);var d=r();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[s,r,n]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={371:0,403:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var r,n,[o,l,i]=s,d=0;if(o.some((t=>0!==e[t]))){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(i)var c=i(a)}for(t&&t(s);d<o.length;d++)n=o[d],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},s=globalThis.webpackChunkwordpress_search_blocks=globalThis.webpackChunkwordpress_search_blocks||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var r=a.O(void 0,[403],(()=>a(299)));r=a.O(r)})();