(()=>{"use strict";var e,t={299:(e,t,s)=>{const r=window.wp.blocks,a=window.wp.data,n=window.wp.element,o=window.wp.coreData,l=window.wp.components,i=window.wp.i18n,d=window.wp.blockEditor,c=window.wp.url,p=window.wp.apiFetch;var _=s.n(p);const w=window.ReactJSXRuntime,u=["attachment","wp_block","wp_template","wp_template_part","wp_navigation","wp_font_face","wp_font_family","menu_item","wp_global_styles","revision","customize_changeset","nav_menu_item","custom_css","oembed_cache"],h=["document_file_id","document_file_name","document_file_size","document_file_type","document_file_url","footnotes","show_inpage_nav"];(0,r.registerBlockType)("wordpress-search/search-metadata-filter",{edit:function({attributes:e,setAttributes:t}){const{selectedMetadata:s}=e,[r,p]=(0,n.useState)([]),[m,f]=(0,n.useState)(!0),v=(0,d.useBlockProps)({className:"wp-block-wordpress-search-metadata-filter-editor"}),{postTypes:b}=(0,a.useSelect)((e=>{const t=e(o.store).getPostTypes({per_page:-1}),s=t?.filter((e=>{const t=u.includes(e.slug),s=Boolean(e.rest_base)&&Boolean(e.rest_namespace),r=!0===e.supports?.["custom-fields"];return!t&&s&&r}));return{postTypes:s}}),[]);return(0,n.useEffect)((()=>{!async function(){if(!b)return;const e=new Set,t=b.map((async e=>{try{const t="wp/v2"===e.rest_namespace?`/wp/v2/${e.rest_base}`:`/${e.rest_namespace}/${e.rest_base}`,s={context:"edit",per_page:1,orderby:"date",order:"desc"},r=(0,c.addQueryArgs)(t,s),a=await _()({path:r,parse:!0});if(Array.isArray(a)&&a.length>0){const t=a[0];return Object.keys(t.metadata||t.meta||{}).filter((e=>!h.includes(e))).map((t=>({label:t,value:`${e.slug}:${t}`})))}return[]}catch(e){return[]}}));try{(await Promise.all(t)).flat().forEach((t=>{e.add(t)}))}catch(e){}const s=Array.from(e).sort(((e,t)=>e.label.localeCompare(t.label)));p(s),f(!1)}()}),[b]),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(d.InspectorControls,{children:(0,w.jsxs)(l.PanelBody,{title:(0,i.__)("Metadata Filter Settings","wordpress-search"),initialOpen:!0,children:[m&&(0,w.jsxs)(l.Placeholder,{children:[(0,w.jsx)(l.Spinner,{}),(0,i.__)("Loading metadata fields…","wordpress-search")]}),!m&&r.length>0&&(0,w.jsx)(l.SelectControl,{label:(0,i.__)("Select Metadata Field","wordpress-search"),value:s,options:[{label:(0,i.__)("Select a field…","wordpress-search"),value:""},...r],onChange:e=>t({selectedMetadata:e})}),!m&&0===r.length&&(0,w.jsxs)("p",{children:[(0,i.__)("No metadata fields found. Make sure your post types:","wordpress-search"),(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:(0,i.__)("Have custom fields enabled","wordpress-search")}),(0,w.jsx)("li",{children:(0,i.__)("Have REST API support","wordpress-search")}),(0,w.jsx)("li",{children:(0,i.__)("Have at least one post with meta values","wordpress-search")}),(0,w.jsx)("li",{children:(0,i.__)("Have meta fields registered with show_in_rest enabled","wordpress-search")})]})]})]})}),(0,w.jsxs)("div",{...v,children:[m&&(0,w.jsxs)("div",{className:"metadata-filter-loading",children:[(0,w.jsx)(l.Spinner,{}),(0,i.__)("Loading metadata options…","wordpress-search")]}),!m&&s&&(0,w.jsxs)("div",{className:"metadata-filter-preview",style:{pointerEvents:"none"},children:[(0,i.__)("Metadata Filter:","wordpress-search")," ",(0,w.jsx)("strong",{children:(()=>{if(!s)return"";const e=r.find((e=>e.value===s));return e?e.label:s})()})]}),!m&&!s&&(0,w.jsx)("div",{className:"metadata-filter-placeholder",style:{pointerEvents:"none"},children:(0,i.__)("Select a metadata field in the block settings sidebar →","wordpress-search")})]})]})},save:()=>null})}},s={};function r(e){var a=s[e];if(void 0!==a)return a.exports;var n=s[e]={exports:{}};return t[e](n,n.exports,r),n.exports}r.m=t,e=[],r.O=(t,s,a,n)=>{if(!s){var o=1/0;for(c=0;c<e.length;c++){for(var[s,a,n]=e[c],l=!0,i=0;i<s.length;i++)(!1&n||o>=n)&&Object.keys(r.O).every((e=>r.O[e](s[i])))?s.splice(i--,1):(l=!1,n<o&&(o=n));if(l){e.splice(c--,1);var d=a();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[s,a,n]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={371:0,403:0};r.O.j=t=>0===e[t];var t=(t,s)=>{var a,n,[o,l,i]=s,d=0;if(o.some((t=>0!==e[t]))){for(a in l)r.o(l,a)&&(r.m[a]=l[a]);if(i)var c=i(r)}for(t&&t(s);d<o.length;d++)n=o[d],r.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return r.O(c)},s=globalThis.webpackChunkwordpress_search_blocks=globalThis.webpackChunkwordpress_search_blocks||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var a=r.O(void 0,[403],(()=>r(299)));a=r.O(a)})();